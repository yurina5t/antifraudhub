
# ๐ก๏ธ AntifraudHub

**AntifraudHub** โ ัะตัะฒะธั ัะบะพัะธะฝะณะฐ ัะธัะบะพะฒ ะธ ะฐะฝัะธััะพะดะฐ ะฝะฐ ะพัะฝะพะฒะต ML-ะผะพะดะตะปะธ.  
ะัะพะตะบั ัะตะฐะปะธะทัะตั ะฟะพะปะฝัะน ัะธะบะป:  
**ะดะฐะฝะฝัะต โ ะผะพะดะตะปั โ ะฑะธะทะฝะตั-ัะตัะตะฝะธะต โ API โ UI โ ััะฐะฝะตะฝะธะต โ Docker**.

---

## ๐ ะะพะทะผะพะถะฝะพััะธ

- ๐ ML-ัะบะพัะธะฝะณ ััะพะดะฐ
- ๐ง 3-ะทะพะฝะฝะฐั ะปะพะณะธะบะฐ ะฟัะธะฝััะธั ัะตัะตะฝะธะน: `ALLOW / REVIEW / BLOCK`
- ๐ฆ Batch-ะฟัะพะณะพะฝ ะฒัะตั ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- ๐ค ะกะบะพัะธะฝะณ ะพะดะฝะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั
- ๐ Analyst-friendly UI (Dashboard)  
- ๐๏ธ ะฅัะฐะฝะตะฝะธะต ะฟัะตะดัะบะฐะทะฐะฝะธะน ะฒ Postgres
- โก ะััะพัะฝะธะบ ะดะฐะฝะฝัั โ ClickHouse
- ๐ Swagger API
- ๐ณ Docker / Docker Compose
- ๐งช Pytest (ะบะพะฝััะฐะบัั + API)
- ๐ ะะฒัะพัะธะทะฐัะธั ะทะฐะปะพะถะตะฝะฐ ะฐััะธัะตะบัััะฝะพ (ะฒัะตะผะตะฝะฝะพ ะพัะบะปััะตะฝะฐ)

---

## ๐ง ะะฝัะธััะพะด-ะปะพะณะธะบะฐ (3 ะทะพะฝั)

| Decision | ะฃัะปะพะฒะธะต ะฟะพ `risk_score` | ะะฝะฐัะตะฝะธะต |
|--------|--------------------------|----------|
| `ALLOW` | `< FRAUD_REVIEW_THRESHOLD` | ะะฐะทัะตัะธัั |
| `REVIEW` | `โฅ FRAUD_REVIEW_THRESHOLD` | ะััะฝะฐั ะฟัะพะฒะตัะบะฐ |
| `BLOCK` | `โฅ FRAUD_BLOCK_THRESHOLD` | ะะปะพะบะธัะพะฒะบะฐ |

ะะพัะพะณะพะฒัะต ะทะฝะฐัะตะฝะธั ะทะฐะดะฐัััั ะฒ ะบะพะฝัะธะณััะฐัะธะธ:

```python
# app/core/config.py
FRAUD_REVIEW_THRESHOLD = 0.134
FRAUD_BLOCK_THRESHOLD = 0.70
```
## ๐ก API
๐น ML Healthcheck (internal).
```
GET /internal/fraud/health
```
๐น Batch-ะฟัะตะดัะบะฐะทะฐะฝะธะต (ะฒัะต ะฟะพะปัะทะพะฒะฐัะตะปะธ). 
```
POST /api/fraud/predict/batch
```
Query-ะฟะฐัะฐะผะตััั (ะพะฟัะธะพะฝะฐะปัะฝะพ):
```
?decision=REVIEW&decision=BLOCK
```
ะะพะทะฒะพะปัะตั ะฒะตัะฝััั ัะพะปัะบะพ ะฟะพะปัะทะพะฒะฐัะตะปะตะน ะฝะฐ ัััะฝัั ะฟัะพะฒะตัะบั ะธ ะฑะปะพะบะธัะพะฒะบั.

๐น ะัะตะดัะบะฐะทะฐะฝะธะต ะดะปั ะพะดะฝะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั
```
GET /api/fraud/predict/user/{user_email}
```
ะัะธะผะตั ะพัะฒะตัะฐ:
```
{
  "user_email": "user@example.com",
  "risk_score": 0.82,
  "decision": "BLOCK"
}
```

## ๐ฅ๏ธ UI / Fraud Analyst Dashboard
ะัะพะตะบั ะฒะบะปััะฐะตั ะฒัััะพะตะฝะฝัะน UI, ะพัะธะตะฝัะธัะพะฒะฐะฝะฝัะน ะฝะฐ ัะฐะฑะพัั fraud-ะฐะฝะฐะปะธัะธะบะฐ.

ะะพะทะผะพะถะฝะพััะธ Dashboard:
- ๐ ะัะพะฒะตัะบะฐ ะฟะพะปัะทะพะฒะฐัะตะปั ะฟะพ email
- ๐ฆ Batch-ะฐะฝะฐะปะธะท ั ัะพะบััะพะผ ะฝะฐ REVIEW ะธ BLOCK
- ๐ฝ ะคะธะปัััะฐัะธั ะฟะพ decision
- ๐ข ะกััััะธะบะธ: BLOCK / REVIEW / ALLOW
- โฌ๏ธ ะกะพััะธัะพะฒะบะฐ ะฟะพ risk_score (DESC)
- โ๏ธ ะะณัะฐะฝะธัะตะฝะธะต ะฒัะฒะพะดะฐ ALLOW (top-100) ะดะปั ัะฝะธะถะตะฝะธั ะฝะฐะณััะทะบะธ
- ๐จ ะฆะฒะตัะพะฒัะต ะฑะตะนะดะถะธ ัะตัะตะฝะธะน

UI ัะพะทะฝะฐัะตะปัะฝะพ ะพะฟัะธะผะธะทะธัะพะฒะฐะฝ ะฟะพะด ัะฐะฑะพัั ั high-risk ัะตะณะผะตะฝัะพะผ,
ัะฐะบ ะบะฐะบ ALLOW ะฟะพะปัะทะพะฒะฐัะตะปะธ ัะพััะฐะฒะปััั ะฑะพะปััะธะฝััะฒะพ ะธ ะฝะต ััะตะฑััั ะฝะตะผะตะดะปะตะฝะฝะพะณะพ ะฒะฝะธะผะฐะฝะธั.

## ๐ธ ะัะธะผะตั ะธะฝัะตััะตะนัะฐ
![Fraud Dashboard](screenshots/antifraudhub_dashboard.png)
> ะัะต ะฟะตััะพะฝะฐะปัะฝัะต ะดะฐะฝะฝัะต ะฝะฐ ัะบัะธะฝัะพัะต ะทะฐะผะฐัะบะธัะพะฒะฐะฝั.

## ๐งฉ ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต ะธ ะฐััะธัะตะบัััะฐ
```
                โโโโโโโโโโโโโโโ
                โ API Gateway โ
                โ   FastAPI   โ
                โโโโโโโโฌโโโโโโโ
                       โ
          โโโโโโโโโโโโโโดโโโโโโโโโโโโโ
          โ                         โ
โโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ
โ realtime-worker โ     โ batch-worker     โ
โ fast, low-lat   โ     โ heavy, offline   โ
โ WORKER_MODE=rt  โ     โ WORKER_MODE=batchโ
โโโโโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโโโโโ
          โ                         โ
          โโโโโโโโโโโโฌโโโโโโโโโโโโโโโ
                     โ
                PostgreSQL
```
ะะดะตั ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธั

- **realtime-api** โ ะพะฑัะปัะถะธะฒะฐะตั ะพะฝะปะฐะนะฝ-ะทะฐะฟัะพัั ั ะผะธะฝะธะผะฐะปัะฝะพะน ะทะฐะดะตัะถะบะพะน
- **batch-worker** โ ะฒัะฟะพะปะฝัะตั ััะถะตะปัะต batch-ะฟัะพะณะพะฝั
- ะะดะธะฝ Docker-ะพะฑัะฐะท, ัะฐะทะฝัะต ัะพะปะธ ัะตัะตะท WORKER_MODE
- ะะตะฐะปะธััะธัะฝัะน production-ะฟะฐััะตัะฝ ะดะปั ะฐะฝัะธััะพะด-ัะธััะตะผ

## ๐๏ธ ะฅัะฐะฝะตะฝะธะต ะดะฐะฝะฝัั

**ClickHouse**
- ะััะพัะฝะธะบ ัะธัะตะน ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- ะัะฟะพะปัะทัะตััั ะดะปั batch ะธ single-user ะฟะฐะนะฟะปะฐะนะฝะพะฒ

**Postgres**
- ะขะฐะฑะปะธัะฐ predictions
- ะฅัะฐะฝะธั:
    - user_email
    - risk_score
    - decision


## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

ะัะฟะพะปัะทัะตััั **pytest**.

ะะพะบัััะพ:

- /health
- API ะบะพะฝััะฐะบั batch ะธ single predict
- preprocess-ะบะพะฝััะฐะบั (FEATURES)

ะะฐะฟััะบ ัะตััะพะฒ:
```
PYTHONPATH=. pytest app/tests -v
```

## โถ๏ธ ะัััััะน ััะฐัั

### ะขัะตะฑะพะฒะฐะฝะธั
- Docker
- Docker Compose

### ะะฐะฟััะบ ะฟัะพะตะบัะฐ

```bash
git clone https://github.com/yurina5t/antifraudhub.git
cd antifraudhub
docker compose up --build
```

## ะะดะต ัะผะพััะตัั

- **Web UI**  
  http://localhost:8000/ui/

- **Swagger API**  
  http://localhost:8000/api/docs

## ๐ณ Docker

**ะกะตัะฒะธัั**
- antifraud-api โ API Gateway (FastAPI)
- antifraud-realtime โ realtime ML worker
- antifraud-batch โ batch ML worker
- postgres โ ััะฐะฝะตะฝะธะต ะฟัะตะดัะบะฐะทะฐะฝะธะน

ะะดะธะฝ Docker-ะพะฑัะฐะท, ัะฐะทะฝัะต ัะพะปะธ ัะตัะตะท WORKER_MODE.

**ะะฐะฟััะบ**
```bash
docker compose up -d
```
ะะตัะตะทะฐะฟััะบ API ะฑะตะท ะฟะตัะตัะฑะพัะบะธ
```bash
docker compose restart antifraud-api
```
## ๐ ะะฒัะพัะธะทะฐัะธั

- JWT-ะฐะฒัะพัะธะทะฐัะธั ัะตะฐะปะธะทะพะฒะฐะฝะฐ ะฐััะธัะตะบัััะฝะพ
- ะัะฟะพะปัะทััััั:
    - dependencies/auth.py
    - dependencies/authz.py
    - auth/jwt_handler.py
- ะัะตะผะตะฝะฝะพ ะพัะบะปััะตะฝะฐ (INTERNAL_MODE = True)
- ะัะต ัะฐะนะปั ัะพััะฐะฝะตะฝั ะดะปั ะฑัะดััะตะณะพ ะฒะบะปััะตะฝะธั
- ะกะตัะฒะธั ัะตะนัะฐั ัะฐะฑะพัะฐะตั ะบะฐะบ ะฒะฝัััะตะฝะฝะธะน (internal).


## ๐งฉ ะกัะตะบ ัะตัะฝะพะปะพะณะธะน

- Python 3.11
- FastAPI
- Pandas / NumPy
- ML-ะผะพะดะตะปั (AutoML)
- ClickHouse
- PostgreSQL
- SQLModel
- Docker / Docker Compose
- Pytest


## ๐ฏ ะกัะฐััั ะฟัะพะตะบัะฐ

โ ะััะธัะตะบัััะฐ ัะฟัะพะตะบัะธัะพะฒะฐะฝะฐ  
โ ML-ะปะพะณะธะบะฐ ัะตะฐะปะธะทะพะฒะฐะฝะฐ  
โ REST API ะณะพัะพะฒ  
โ Docker-ะพะบััะถะตะฝะธะต ะณะพัะพะฒะพ  
โ ะขะตััั ะดะพะฑะฐะฒะปะตะฝั  
๐ง ะะฒัะพัะธะทะฐัะธั ะพัะบะปััะตะฝะฐ (ะพัะพะทะฝะฐะฝะฝะพ)  
